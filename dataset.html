<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="$1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="form.css">
    <link rel="stylesheet" type="text/css" href="font-awesome-4.7.0\css\font-awesome.min.css">
    <link rel="icon" href="images\corridor-icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jexcel/2.0.0/css/jquery.jexcel.min.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.3/jquery.csv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jexcel/2.0.0/js/jquery.jexcel.js"></script>
    <script src="corimport.js" type="text/javascript"></script>

    <title>CorImport Web Tool</title>

  </head>
  <body>

  <div class="style">
    <form>
      <div class="menu-container" onclick="openHelpMenu(this)">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
            <div id="help-menu-contents" class="dropdown-content">
              <a href="https://support.corridor.aero/hc/en-us/sections/115000828514-CorImport">CorImport How-To</a>
              <a href="https://support.corridor.aero/hc/en-us/categories/115001230327-FAQ">Corridor FAQ</a>
              <a href="#">Launch corimport.exe</a>
            </div>
      </div>
      <a href="https://www.corridor.aero/"><img src="images\CORRIDOR-CAMP-Systems-White-copy.png" alt="CORRIDOR"></a><br/>
      <div id="sub-div">
        <div id="header-container">
          <h1 id="data-set-name"></h1><br/>
          <p id="data-file-name"></p><br/><br/>
          <hr id="dataset-hr"/><br/>
        </div>
        <div id="spreadsheet"></div><br/>
        <div class="button-container">
          <button type="button" id="btnDownloadCSV" class="button-style"><i class="fa fa-download"></i>    Download CSV</button><br/>
          <button type="button" id="btnSendToSupport" class="button-style"><i class="far fa-envelope"></i>   Send to CORRIDOR Support</button><br/>
          <button type="button" id="btnRestart" class="button-style"><i class="fa fa-repeat" aria-hidden="true"></i>    Restart</button>
        </div>
      </div>
    </form>
  </div>

  <div id="email-modal">
    <div id="email-modal-content">
      <span class="information"><i id="email-info" class="fas fa-info-circle"></i></span>
      <span id="modal-close" class="close"><i class="far fa-times-circle"></i></span><br/>
      <h2>Send File to Corridor Support</h2>
      <p>Subject: <input type="text" id="email-subject" class="modal-h2"></p>
      <textarea rows="10" placeholder="Include a message..."></textarea><br>
      <p>Attach the error log: </br><input type="file" name="fileToUpload" accept=".txt" required/></p>
      </hr>
      <div class="index-button-container">
        <button id="btnEmailSupport" class="button-style"><i class="fas fa-paper-plane"></i>   Send</button>
      </div>
    </div>
  </div>

<script type="text/javascript">
var dataSetName = document.getElementById('data-set-name');
var dataFileName = document.getElementById('data-file-name');
var data = localStorage.getItem("dataFileName");
var emailModal = document.getElementById('email-modal');

//Display help menu
function openHelpMenu(x) {
  var helpMenuContents = document.getElementById("help-menu-contents");

  if (helpMenuContents.style.display !== "block") {
    helpMenuContents.style.display = "block";
  } else {
    helpMenuContents.style.display = "none";
  }

  x.classList.toggle("change");
}

if (localStorage.getItem('dataSetName') == null) {
  dataSetName.innerHTML = "CorImport Web Tool";
  alert('Please return the the home page and select a Data Set and a Data File to format.');
} else {
  dataSetName.innerHTML = localStorage.getItem('dataSetName') + " Import";
}

if (data == null) {
  dataFileName.innerHTML = "**No file has been selected**";
  dataFileName.style.color = '#FF0000';
} else {
  var trimFileName = localStorage.getItem('fileURL').slice(12);
  dataFileName.innerHTML = "The name of this file is " + trimFileName;
}

//Spreadsheet entry
$('#spreadsheet').jexcel({
// file path of the CSV file
csv: localStorage.getItem("fullFilePath"),
// Get the first of the CSV file and consider the headers
csvHeaders: true,
tableOverflow: true,
tableHeight: '415px',
colWidths: [ 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300]
});

//Download CSV button function, thn return to index.html
$('#btnDownloadCSV').on('click', function () {
   $('#spreadsheet').jexcel('download');
 });

//Retrun to index.html
 $('#btnRestart').on('click', function () {
   location.href = 'index.html';
 });

// When the user clicks the button, open the email modal and populate the subject line
 $("#btnSendToSupport").click(function() {
   $("#email-modal").fadeIn('fast');
   $("#email-subject").val(localStorage.getItem('dataSetName') + ' CorImport Issue');
 });

 $("#email-info").click(function() {
   alert("This window will allow you to send the date file for review to Corridor Support. Please include your name, aswell as the name of the Company that you are loading the data for in the message of this email.");
 });

// When the user clicks on <span> (x), close the email modal
 $("#modal-close").click(function() {
   $("#email-modal").fadeOut('fast');
 });
// When the user clicks anywhere outside of the modal, close it
 $(window).click(function(event) {
   if (event.target == emailModal) {
     $("#email-modal").fadeOut('fast');
   }
 });
 </script>

  </body>
</html>
